.\" This manpage has been automatically generated by docbook2man 
.\" from a DocBook document.  This tool can be found at:
.\" <http://shell.ipoline.com/~elmert/comp/docbook2X/> 
.\" Please send any bug reports, improvements, comments, patches, 
.\" etc. to Steve Cheng <steve@ggi-project.org>.
.TH "GFPREP" "1" "19 October 2012" "Gfarm" ""

.SH NAME
gfprep \- replicate Gfarm files in parallel
.SH SYNOPSIS

\fBgfprep\fR [ \fB-nqvdpPU\fR ] [ \fB-mx\fR ] [ \fB-S \fIsource-domainname\fB\fR ] [ \fB-h \fIsource-hostfile\fB\fR ] [ \fB-D \fIdestination-domainname\fB\fR ] [ \fB-H \fIdestination-hostfile\fB\fR ] [ \fB-j \fInum-of-processes\fB\fR ] [ \fB-w \fIway-of-scheduling\fB\fR ] [ \fB-W \fIkilobytes-for-threshold\fB\fR ] [ \fB-s \fIKB/s-to-simulate\fB\fR ] [ \fB-F \fInum-for-readahead\fB\fR ] [ \fB-N \fInum-of-replicas\fB\fR ] \fB\fIgfarm-url\fB\fR

.SH "DESCRIPTION"
.PP
\fBgfprep\fR creates replicas of Gfarm files specified by
the \fIgfarm-url\fR(gfarm:///...) in parallel.
.PP
When a set of source hosts are specified, only files stored on the set
of source hosts are replicated.  A set of hosts can be specified by a
domain name and/or a host file.  When both a domain name and a host
file are specified, a set of hosts is determined by both conditions.
.PP
If the \fIgfarm-url\fR parameter is a directory,
files under the directory will be replicated recursively.
.PP
\fBgfprep\fR can also read the directory and get
informations of the entries in parallel.
.SH "GFPREP OPTIONS"
.PP
These are the options only for \fBgfprep\fR\&.
.TP
\fB-N \fInum-of-replicas\fB\fR
Specifies the required number of file replicas.  If there are a
sufficient number of replicas in the destination hosts, neither any
copying nor any removal will be done.

If this option is not specified, -N 1 is assumed.
.TP
\fB-x\fR
Removes file replicas when a set of destination nodes has more file
replicas than specified by -N option.
.TP
\fB-m\fR
Migrates replicas within a set of source nodes to destination nodes.

This option requires -S or -h or -D or -H options.

This option and -N option are mutually exclusive.
.SH "COMMON OPTIONS"
.PP
\fBgfprep\fR has the same options with \fBgfpcopy\fR\&.
.TP
\fB-S \fIsource-domainname\fB\fR
Specifies the domain name of source filesystem nodes from which
replicas will be copied.
.TP
\fB-h \fIsource-hostfile\fB\fR
Specifies a file which describes hostnames of
source filesystem nodes from which the replica will be copied.
The \fIsource-hostfile\fR consists of a filesystem
node name on each line.

If ``-'' is specified, standard input is used to read the host list.
.TP
\fB-L\fR
Selects source filesystem nodes within a set of specified source nodes.

.TP
\fB-D \fIdestination-domainname\fB\fR
Specifies the domain name of destination filesystem nodes to which
replicas will be copied.

If neither this nor the \fB-H\fR option is specified,
replicas may be copied to any available host.
.TP
\fB-H \fIdestination-hostfile\fB\fR
Specifies a file which describes hostnames of
destination filesystem nodes on which the replica will be copied.
The \fIdestination-hostfile\fR consists of a
filesystem node name on each line.

If ``-'' is specified, standard input is used to read the host list.
.TP
\fB-j \fInum-of-processes\fB\fR
Specifies the number of processes to create file replicas (or copy
files) simultaneously and to read the directory in parallel.  Child
processes are created of \fInum-of-processes\fR * 2
processes.

The default value is the parameter of client_parallel_copy in gfarm2.conf.
(see man gfarm2.conf)

The source nodes and the destination nodes are selected/scheduled and
used(read/written) up to the number of CPUs (see
man \fBgfhost\fR) at the same time.
.TP
\fB-w \fIway-of-scheduling\fB\fR
Specifies the name of scheduling way.
``noplan'' replicates/copies in order that the files are found.
``greedy'' schedules greedily the order of replication/copy beforehand.

The default behavior is ``noplan''.

``greedy'' scheduling cannot use the -N option or -m option.
.TP
\fB-W \fIkibibytes\fB\fR
Specifies a threshold size/cost(KiB) to flat costs of Connections.
A Connection means a scheduling information (assgined files) per a
child-process.

This option is effective with -w greedy.

The default value is 50*1024 KiB (50MiB).
.TP
\fB-U\fR
Disables checking the available disk space of the selected node every
time.
.TP
\fB-F \fInum-of-dirents\fB\fR
Specifies a number of entries to perform the directory readahead.

The default value is 10000.
.TP
\fB-s \fIkilobytes-per-sec.\fB\fR
Specifies a throughput(KB/s) to simulate the replication/copy, and
does nothing (gets file informations only).
.TP
\fB-n\fR
Does nothing.
.TP
\fB-p\fR
Reports the total performance and various results.
.TP
\fB-P\fR
Reports the each and total performance and various results.
.TP
\fB-q\fR
Suppresses non-error messages.
.TP
\fB-v\fR
Displays verbose output.
.TP
\fB-d\fR
Displays debug output.
.TP
\fB-?\fR
Displays a list of command options.
.SH "EXAMPLES"
.PP
To replicate files under the directory recursively.

.nf
$ gfprep -N 3 gfarm:///dir
.fi
.PP
To replicate a file or reduce surplus replicas of the file.

.nf
$ gfprep -N 3 -x gfarm:///dir/file
.fi
.PP
To migrate replicas from gfsd1.example.com to other nodes.

.nf
$ gfprep -m -S gfsd1.example.com gfarm:///
.fi
.SH "NOTES"
.PP
If the -L or -m option is not specified, a source node is not always
selected within a set of specified source nodes.
.PP
\fBgfprep\fR command should be executed at the same host
of gfmd.  If the gfmd and \fBgfprep\fR are far apart,
the \fBgfprep\fR operation is slow.  Specifying a large
value by the -j option or client_parallel_copy in gfarm2.conf may be
effective in such a case.
.SH "SEE ALSO"
.PP
\fBgfrep\fR(1),
\fBgfpcopy\fR(1),
\fBgfhost\fR(1),
\fBgfarm2.conf\fR(5)
